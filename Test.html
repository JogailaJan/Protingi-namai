<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Home System Questionnaire</title>
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 20px;
        background-color: #f4f4f4;
    }

    h1 {
        text-align: center;
        color: #333;
    }

    form {
        max-width: 600px;
        margin: 0 auto;
        background-color: #fff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }

    h2 {
        margin-top: 20px;
        margin-bottom: 10px;
        color: #555;
        display: inline-block; /* Added */
    }

    label {
        display: block;
        margin-bottom: 10px;
    }

    input[type="checkbox"] {
        margin-right: 5px;
        vertical-align: middle;
    }

    .service-area{
        display: none;
    }

    input[type="submit"] {
        display: block;
        width: 100%;
        padding: 10px;
        margin-top: 20px;
        background-color: #4CAF50;
        color: #fff;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
    }

    input[type="submit"]:hover {
        background-color: #45a049;
    }

    .checkbox-container {
    display: flex;
    align-items: center;
  }

  .checkbox-container input[type="checkbox"] {
    margin-right: 10px;
  }

  .checkbox-container h2 {
    margin: 0;
  }

</style>
</head>
<body>
    <!-- Gal kazkada prireiks, tik name reiks pakeist -->
    <!-- <label><input type="checkbox" name="lighting" value="bluetooth-LE" class="functionality"> Bluetooth LE (<span>0/0</span>)</label><br>
    <label><input type="checkbox" name="lighting" value="eNet" class="functionality"> eNet (<span>0/0</span>)</label><br>
    <label><input type="checkbox" name="lighting" value="KNX" class="functionality"> KNX (<span>0/0</span>)</label><br>
    <label><input type="checkbox" name="lighting" value="IP" class="functionality"> IP (<span>0/0</span>)</label><br>
    <label><input type="checkbox" name="lighting" value="wireless" class="functionality"> Wireless (<span>0/0</span>)</label><br>
    <label><input type="checkbox" name="lighting" value="REG-bus" class="functionality"> REG bus (<span>0/0</span>)</label><br>
    <label><input type="checkbox" name="lighting" value="TP" class="functionality"> TP (<span>0/0</span>)</label><br>
    <label><input type="checkbox" name="lighting" value="ethernet" class="functionality"> Ethernet (<span>0/0</span>)</label><br> -->
    <h1>Smart Home System Questionnaire</h1>
    <form id="questionnaireForm">

        <div class="checkbox-container">
            <input type="checkbox" name="lighting" value="lighting" class="service-area">
            <h2>Lighting (<span>0/0</span>)</h2>
        </div>
        <div id="lightingOptions" style="display: none;">
            <label><input type="checkbox" name="lighting" value="switching" class="functionality"> Switching (<span>0/0</span>)</label><br>
            <label><input type="checkbox" name="lighting" value="colour" class="functionality"> Colour (<span>0/0</span>)</label><br>
            <label><input type="checkbox" name="lighting" value="sequences" class="functionality"> Sequences (<span>0/0</span>)</label><br>
            <!-- Add more options as needed -->
        </div>

        <div class="checkbox-container">
            <input type="checkbox" name="security" value="security" class="service-area">
            <h2>Security (<span>0/0</span>)</h2>
        </div>
        <div id="lightingOptions" style="display: none;">
            <label><input type="checkbox" name="security" value="storm-rain-satellite-unit" class="functionality"> Storm/Rain Satellite Unit(<span>0/0</span>)</label><br>
            <label><input type="checkbox" name="security" value="storm-rain-universal-transmitter" class="functionality"> Storm/Rain Universal Transmitter (<span>0/0</span>)</label><br>
            <label><input type="checkbox" name="security" value="storm-rain" class="functionality"> Storm/Rain (<span>0/0</span>)</label><br>
            <label><input type="checkbox" name="security" value="leakage" class="functionality"> Leakage (<span>0/0</span>)</label><br>
            <!-- Add more options as needed -->
        </div>
    
        <input type="submit" value="Submit">

    <script>
            "IntelliHome Automation": {
        const systemsData = {
            system1: {
                name: 'LB MANAGEMENT',
                link: 'http://system1',
                functionalities: ['bluetooth-LE', 'wireless'],
                serviceAreas: {
                    lighting: ['switching'],
                    blinds: ['blinds'],
                    security: ['storm-rain-satellite-unit']
                }
            },
            system2: {
                name: 'eNet SMART HOME',
                link: 'http://system2',
                functionalities: ['eNet', 'wireless', 'REG-bus'],
                serviceAreas: {
                    lighting: ['switching'],
                    blinds: ['blinds'],
                    security: ['storm-rain-universal-transmitter'],
                    hvac: ['radiator-thermostat'],
                    scenes: ['scenes-via-wall-transmitter'],
                    energy: ['energy-measurement']
                }
            },
            system3: {
                name: 'KNX SMART VISU SERVER',
                link: 'http://system3',
                functionalities: ['KNX', 'IP', 'wireless', 'TP', 'ethernet'],
                serviceAreas: {
                    lighting: ['switching', 'colour'],
                    blinds: ['blinds', 'skylights'],
                    security: ['storm-rain', 'leakage'],
                    hvac: ['radiator-thermostat', 'boiler'],
                    scenes: ['scenes-via-wall-transmitter', 'over-100-scenes'],
                    energy: ['energy-measurement'],
                    weather: ['weather-forecast'],
                    windowAndDoorMonitoring: ['window-and-door-monitoring']
                }
            },
            system4: {
                name: 'KNX VISU PRO SERVER',
                link: 'http://system4',
                functionalities: ['KNX', 'IP', 'wireless', 'TP', 'ethernet'],
                serviceAreas: {
                    lighting: ['switching', 'colour', 'sequences'],
                    blinds: ['blinds', 'skylights'],
                    security: ['storm-rain', 'leakage'],
                    hvac: ['radiator-thermostat', 'boiler'],
                    scenes: ['scenes-via-wall-transmitter', 'unlimited-scenes'],
                    energy: ['energy-measurement', 'SENEC-Home-battery-storage'],
                    weather: ['weather-forecast', 'creation-of-rules'],
                    windowAndDoorMonitoring: ['window-and-door-monitoring']
                }
            }
        };

        let selectedCriteria = {};
        var criteriaCount = 0;
        window.addEventListener('load', function() {
            updateCheckboxCounts();
        });
        // Function to update the checkboxes with counts
        function updateCheckboxCounts() {
            // Update service area checkboxes
            document.querySelectorAll('.service-area').forEach(function(checkbox) {
                checkbox.nextElementSibling.innerText = checkbox.nextElementSibling.innerText.replace(/\(\d+\/\d+\)/, "(" + checkServiceWithCriteria(checkbox) + "/" + checkServiceWithoutCriteria(checkbox) + ")");
            });

            // Update functionality checkboxes
            document.querySelectorAll('.functionality').forEach(function(checkbox) {
                checkbox.nextElementSibling.innerText = checkbox.nextElementSibling.innerText.replace(/\(\d+\/\d+\)/, "(" + checkFunctionalityWithCriteria(checkbox) + "/" + checkFunctionalityWithoutCriteria(checkbox) + ")");
            });
        }


        function checkServiceWithoutCriteria(checkbox){
            let count = 0;
            for (var company in companies) {
                if (companies[company].hasOwnProperty(checkbox.value)) {
                    count++;
                }
            }
            return count;
        }

        function checkServiceWithCriteria(checkbox){
            let count = 0;
            for (var company in companies) {
                var satisfiesAllCriteria = true;
                //console.log(company);
                // Check if the company satisfies all selected criteria
                if(criteriaCount!=0){
                    //console.log(company);
                    //console.log(criteriaCount);
                    for (var category in selectedCriteria) {
                        // console.log(category);
                        if(!companies[company].hasOwnProperty(category)){
                            satisfiesAllCriteria = false;
                            break;
                        }
                        else{
                            if (!companies[company][category].hasOwnProperty(selectedCriteria[category])) {
                                // console.log(!companies[company][category].hasOwnProperty(selectedCriteria[category]));
                                satisfiesAllCriteria = false;
                                break;
                            }
                        }
                    }
                }
                else{
                    //console.log(checkbox.value);
                    if(!companies[company].hasOwnProperty(checkbox.value)){
                        satisfiesAllCriteria = false;
                    }
                }
                

                // If the company satisfies all selected criteria, check if it provides the additional functionality
                if (satisfiesAllCriteria ) {
                    //if(companies[company][checkbox.name].includes(checkbox.value)){
                        count++;
                    //}
                }
                // console.log(companies[company][checkbox.name]);
                // console.log(checkbox.value);
            }
            return count;
        }

        function checkFunctionalityWithoutCriteria(checkbox){
            let count = 0;
            for (var company in companies) {
                for (var category in companies[company]) {
                    console.log(companies[company][category]);
                    console.log(checkbox.value);
                    console.log(companies[company][category].includes(checkbox.value));
                    if (companies[company][category].includes(checkbox.value)) {
                        count++;
                        console.log(count);
                        break; // Break out of the inner loop once the functionality is found for this company
                    }
                }
            }
            console.log("Official count - " + count);
            return count;
        }

        function checkFunctionalityWithCriteria(checkbox) {
            let count = 0;

            for (var company in companies) {
                var satisfiesAllCriteria = true;
                // console.log(company);
                // Check if the company satisfies all selected criteria
                if(criteriaCount==0){
                    if(companies[company].hasOwnProperty(checkbox.name)){//&&companies[company][checkbox.name].hasOwnProperty(checkbox.value)
                        // console.log(companies[company][checkbox.name]);
                        // console.log(checkbox.value);
                        // console.log(companies[company][checkbox.name][checkbox.value]);
                        count++;
                        // console.log(count);
                        continue;
                    }
                }
                else{
                    for (var category in selectedCriteria) {
                        // console.log(!companies[company][category].hasOwnProperty(selectedCriteria[category]));
                        if (!companies[company][category].hasOwnProperty(selectedCriteria[category])) {
                            satisfiesAllCriteria = false;
                            break;
                        }
                    }
                }
                

                // If the company satisfies all selected criteria, check if it provides the additional functionality
                if (satisfiesAllCriteria ) {
                    //if(companies[company][checkbox.name].includes(checkbox.value)){
                        count++;
                    //}
                }
                // console.log(companies[company][checkbox.name]);
                // console.log(checkbox.value);
            }

            return count;
        }

        function addCriteria(input){
            criteriaCount++;
            document.querySelectorAll('input[type="checkbox"][class="functionality"]:checked').forEach(function(input) {
                var category = input.name;
                var option = input.value;

                // If it's a main category checkbox, store the category name
                if (input.className === 'service-area') {
                    if (!selectedCriteria.hasOwnProperty(category)) {
                        selectedCriteria[category] = [];
                    }
                } else { // If it's an option checkbox
                    if (!selectedCriteria.hasOwnProperty(category)) {
                        selectedCriteria[category] = [option];
                    } else {
                        if (!selectedCriteria[category].includes(option)) {
                            selectedCriteria[category].push(option);
                        }
                    }
                }
            });
        }

        // Add event listeners to show options based on user selections
        document.querySelectorAll('input[type="checkbox"]').forEach(function(input) {
            input.addEventListener('change', function() {
                var relatedOptionsDivId = this.name + 'Options';
                var relatedOptionsDiv = document.getElementById(relatedOptionsDivId);

                if (relatedOptionsDiv) { // Check if the related options div exists
                    if (this.checked) {
                        relatedOptionsDiv.style.display = 'block';
                    } else {
                        relatedOptionsDiv.style.display = 'none';
                    }
                }

                // Call the function to count and log matching companies
                addCriteria(input);
                updateCheckboxCounts();

            });
        });

        // Add JavaScript logic to handle form submission and data processing
        document.getElementById('questionnaireForm').addEventListener('submit', function(event) {
            event.preventDefault(); // Prevent form submission

            // Gather user responses
            var formData = new FormData(this);
            var responses = {};
            for (var pair of formData.entries()) {
                if (responses.hasOwnProperty(pair[0])) {
                    if (!Array.isArray(responses[pair[0]])) {
                        responses[pair[0]] = [responses[pair[0]]];
                    }
                    responses[pair[0]].push(pair[1]);
                } else {
                    responses[pair[0]] = pair[1];
                }
            }

            // Display responses (for demonstration purposes)
            console.log('User Responses:', responses);

            // You can now send the responses to a server for further processing
            // or perform any other actions based on the user's input.
        });
    </script>
</body>
</html>
